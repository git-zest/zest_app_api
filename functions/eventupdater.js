var mongoose=require('mongoose')
var Schema=mongoose.Schema;
mongoose.Promise=require('bluebird');
var db=mongoose.connection;
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
var selectiondetailssch=new Schema({
  emailid:"String",
  event1:"String",
  event2:"String",
  event3:"String",
  event4:"String",
  event5:"String",
  event6:"String",
  event7:"String",
  event8:"String",
  event9:"String",
});
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
var updateselectionobj=mongoose.model('db_selectiondetails',selectiondetailssch)
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
module.exports.selectioncheck=function(emailid,callback){
  mongoose.connect('mongodb+srv://zestapp:ammu@cluster0-etvhe.mongodb.net/',{dbName: 'zest_app_mongodb'},function(err){
    if(err){
      console.log(err);
      db.close();
      model="db failed";
      callback(model);
    }

    //var documets_mbl=new mobileregobj({"mobilemodelnumber":modelname,"mobilemodelname":modelnumber,"event1":event1,"event2":event2,"event3":event3,"event4":event4});
    var mobileregisterdata={"emailid":emailid};
    updateselectionobj.findOne(mobileregisterdata).count(function(err,count){
      if(err){
        model="db failed";
        callback(model);
      }
      else{
        if(count===0){
          db.close();
          model="selectionscreen";
          callback(model);
        }else{
          db.close();
          model="homescreen";
          callback(model);
        }
      }
    });
});
}
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
module.exports.selectionadd=function(emailid,event1,event2,callback){
  mongoose.connect('mongodb+srv://zestapp:ammu@cluster0-etvhe.mongodb.net/',{dbName: 'zest_app_mongodb'},function(err){
    if(err){
      console.log(err);
      db.close();
      model="db failed";
      callback(model);
    }
  var documets_mbl=new updateselectionobj({"emailid":emailid,"event1":event1,"event2":event2});
  documets_mbl.save(function(err){
    if(err){
      db.close();
      model="db failed";
      callback(model);
    }
    console.log("saved");
    db.close();
    model="success";
    callback(model);
    });
  });
}
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
module.exports.selectionupdate=function(modelname,modelnumber,callback){
  mongoose.connect('mongodb+srv://zestapp:ammu@cluster0-etvhe.mongodb.net/',{dbName: 'zest_app_mongodb'},function(err){
    if(err){
      console.log(err);
      db.close();
      model="db failed";
      callback(model);
    }
    //mobileregobj.findOne(mobileregisterdata).
  });
}
